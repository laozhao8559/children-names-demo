<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šè¯­è¨€æ ‡ç­¾æµ‹è¯•</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸŒ å¤šè¯­è¨€æ ‡ç­¾ç”Ÿæˆæµ‹è¯•</h1>
            <p>æµ‹è¯•æ¯ç§è¯­è¨€ç»„åˆçš„æ ‡ç­¾ç”Ÿæˆæ•ˆæœ</p>
        </header>

        <main class="main-content">
            <div class="step-content active">
                <h2>ğŸ¯ è¯­è¨€ç»„åˆæµ‹è¯•</h2>

                <form id="testForm">
                    <div class="form-group">
                        <label>é€‰æ‹©ä¸»é¢˜:</label>
                        <select id="theme" name="theme" required>
                            <option value="è¶…å¸‚">è¶…å¸‚</option>
                            <option value="åŒ»é™¢">åŒ»é™¢</option>
                            <option value="å…¬å›­">å…¬å›­</option>
                            <option value="å­¦æ ¡">å­¦æ ¡</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label><strong>é€‰æ‹©è¯­è¨€ç»„åˆ:</strong></label>
                        <div style="margin: 15px 0;">
                            <button type="button" class="btn btn-secondary" onclick="selectLanguages(['chinese'])">ä»…ä¸­æ–‡</button>
                            <button type="button" class="btn btn-secondary" onclick="selectLanguages(['chinese', 'english'])">ä¸­æ–‡+è‹±æ–‡</button>
                            <button type="button" class="btn btn-secondary" onclick="selectLanguages(['chinese', 'pinyin'])">ä¸­æ–‡+æ‹¼éŸ³</button>
                            <button type="button" class="btn btn-secondary" onclick="selectLanguages(['chinese', 'pinyin', 'english'])">ä¸­æ–‡+æ‹¼éŸ³+è‹±æ–‡</button>
                            <button type="button" class="btn btn-secondary" onclick="selectLanguages(['chinese', 'pinyin', 'english', 'japanese'])">å…¨é€‰</button>
                        </div>

                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="languages" value="chinese" checked>
                                <span>ä¸­æ–‡</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="languages" value="pinyin">
                                <span>æ‹¼éŸ³</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="languages" value="english">
                                <span>è‹±æ–‡</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="languages" value="japanese">
                                <span>æ—¥æ–‡</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">ç”Ÿæˆæµ‹è¯•æ ‡ç­¾</button>
                </form>

                <!-- æµ‹è¯•ç»“æœ -->
                <div id="testResults" style="margin-top: 30px; display: none;">
                    <h3>ğŸ“‹ æµ‹è¯•ç»“æœ</h3>

                    <div class="result-section">
                        <h4>å½“å‰é€‰æ‹©çš„è¯­è¨€ç»„åˆ:</h4>
                        <div id="selectedLanguages" style="font-size: 1.2em; font-weight: bold; color: #2196F3;"></div>
                    </div>

                    <div class="result-section">
                        <h4>ç”Ÿæˆçš„æ ‡ç­¾ç¤ºä¾‹ (å‰5ä¸ª):</h4>
                        <div id="tagExamples" style="background: #f8f9fa; padding: 15px; border-radius: 8px;"></div>
                    </div>

                    <div class="result-section">
                        <h4>è¯¦ç»†æ ‡ç­¾åˆ—è¡¨:</h4>
                        <div id="fullTagList"></div>
                    </div>

                    <div class="result-section">
                        <h4>æœ€ç»ˆPromptæµ‹è¯•:</h4>
                        <div style="background: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #ff9800;">
                            <strong>é¢„æœŸæ ‡ç­¾æ ¼å¼:</strong>
                            <div id="expectedFormat"></div>
                        </div>

                        <button class="btn btn-primary" onclick="copyTestPrompt()" style="margin-top: 10px;">å¤åˆ¶æµ‹è¯•Prompt</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="vocabulary.js"></script>
    <script>
        let userData = {};
        let vocabulary = [];
        let tags = [];

        function selectLanguages(languageArray) {
            // æ¸…é™¤æ‰€æœ‰é€‰æ‹©
            document.querySelectorAll('input[name="languages"]').forEach(checkbox => {
                checkbox.checked = false;
            });

            // é€‰æ‹©æŒ‡å®šè¯­è¨€
            languageArray.forEach(lang => {
                const checkbox = document.querySelector(`input[name="languages"][value="${lang}"]`);
                if (checkbox) checkbox.checked = true;
            });
        }

        function showExpectedFormat(languages) {
            const formatMap = {
                'chinese': 'ä¸­æ–‡',
                'chinese,english': 'ä¸­æ–‡ (english)',
                'chinese,pinyin': 'ä¸­æ–‡ [pÄ«nyÄ«n]',
                'chinese,pinyin,english': 'ä¸­æ–‡ [pÄ«nyÄ«n] (english)',
                'chinese,pinyin,english,japanese': 'ä¸­æ–‡ [pÄ«nyÄ«n] (english) {japanese}'
            };

            const key = languages.join(',');
            return formatMap[key] || languages.join(' + ');
        }

        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // æ”¶é›†æ•°æ®
            const formData = new FormData(e.target);
            userData = {
                theme: formData.get('theme'),
                languages: formData.getAll('languages'),
                title: 'å¤šè¯­è¨€æµ‹è¯•'
            };

            if (userData.languages.length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ç§è¯­è¨€ï¼');
                return;
            }

            // ç”Ÿæˆè¯æ±‡
            vocabulary = getVocabulary(userData.theme, 'level1').slice(0, 5); // åªå–5ä¸ªç”¨äºæµ‹è¯•
            console.log('æµ‹è¯•è¯æ±‡:', vocabulary);

            // ç”Ÿæˆæ ‡ç­¾
            tags = generateTagText(vocabulary, userData.languages);
            console.log('ç”Ÿæˆçš„æ ‡ç­¾:', tags);

            // æ˜¾ç¤ºç»“æœ
            showResults();
        });

        function showResults() {
            document.getElementById('testResults').style.display = 'block';

            // æ˜¾ç¤ºé€‰æ‹©çš„è¯­è¨€
            const languageNames = {
                'chinese': 'ä¸­æ–‡',
                'pinyin': 'æ‹¼éŸ³',
                'english': 'è‹±æ–‡',
                'japanese': 'æ—¥æ–‡'
            };

            const selectedLangNames = userData.languages.map(lang => languageNames[lang]).join(' + ');
            document.getElementById('selectedLanguages').textContent = selectedLangNames;

            // æ˜¾ç¤ºæ ‡ç­¾ç¤ºä¾‹
            const examplesHtml = tags.slice(0, 5).map((tag, index) => {
                return `<div style="margin: 5px 0; padding: 8px; background: white; border-radius: 4px; border-left: 3px solid #4CAF50;">
                    <strong>${vocabulary[index].chinese}:</strong> ${tag}
                </div>`;
            }).join('');

            document.getElementById('tagExamples').innerHTML = examplesHtml;

            // æ˜¾ç¤ºå®Œæ•´æ ‡ç­¾åˆ—è¡¨
            const fullListHtml = `
                <table class="vocabulary-table" style="width: 100%;">
                    <thead>
                        <tr>
                            <th>ç‰©å“</th>
                            <th>ç”Ÿæˆçš„æ ‡ç­¾</th>
                            <th>æ£€æŸ¥</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${vocabulary.map((item, index) => {
                            const hasAllLanguages = checkTagCompleteness(tags[index], userData.languages);
                            return `
                                <tr>
                                    <td><strong>${item.chinese}</strong></td>
                                    <td>${tags[index]}</td>
                                    <td style="color: ${hasAllLanguages ? '#4CAF50' : '#f44336'}">
                                        ${hasAllLanguages ? 'âœ… å®Œæ•´' : 'âŒ ç¼ºå¤±'}
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('fullTagList').innerHTML = fullListHtml;

            // æ˜¾ç¤ºé¢„æœŸæ ¼å¼
            document.getElementById('expectedFormat').innerHTML = `
                <div style="font-size: 1.1em; margin: 10px 0;">
                    æœŸæœ›æ ¼å¼: <strong>${showExpectedFormat(userData.languages)}</strong>
                </div>
                <div style="font-size: 0.9em; color: #666;">
                    æ¯ä¸ªæ ‡ç­¾éƒ½åº”è¯¥åŒ…å«æ‰€æœ‰é€‰æ‹©çš„è¯­è¨€éƒ¨åˆ†
                </div>
            `;
        }

        function checkTagCompleteness(tag, languages) {
            // æ£€æŸ¥æ ‡ç­¾æ˜¯å¦åŒ…å«æ‰€æœ‰é€‰æ‹©çš„è¯­è¨€
            let hasAll = true;

            if (languages.includes('chinese') && !tag.match(/[\u4e00-\u9fa5]+/)) hasAll = false;
            if (languages.includes('pinyin') && !tag.match(/\[[a-zA-Z\s]+\]/)) hasAll = false;
            if (languages.includes('english') && !tag.match(/\([a-zA-Z\s]+\)/)) hasAll = false;
            if (languages.includes('japanese') && !tag.match(/\{[\u3040-\u309f\u30a0-\u30ff\s]+\}/)) hasAll = false;

            return hasAll;
        }

        function copyTestPrompt() {
            const prompt = `å¤šè¯­è¨€æ ‡ç­¾æµ‹è¯•
ä¸»é¢˜: ${userData.theme}
è¯­è¨€ç»„åˆ: ${userData.languages.join(' + ')}
è¯æ±‡: ${vocabulary.map(v => v.chinese).join('ã€')}
æ ‡ç­¾ç¤ºä¾‹: ${tags.slice(0, 3).join('ï¼Œ')}

è¯·ç¡®ä¿æ¯ä¸ªç‰©å“çš„æ ‡ç­¾éƒ½åŒ…å«æ‰€æœ‰é€‰æ‹©çš„è¯­è¨€ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
${tags.map((tag, index) => `${vocabulary[index].chinese}: ${tag}`).join('\n')}`;

            navigator.clipboard.writeText(prompt).then(() => {
                alert('æµ‹è¯•Promptå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }
    </script>
</body>
</html>