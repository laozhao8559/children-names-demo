<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­¥éª¤è·³è½¬è°ƒè¯•</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ”§ æ­¥éª¤è·³è½¬è°ƒè¯•</h1>
            <p>ä¸“é—¨æµ‹è¯•é¡µé¢è·³è½¬åŠŸèƒ½</p>
        </header>

        <main class="main-content">
            <!-- æ­¥éª¤1 -->
            <div id="step1" class="step-content active">
                <h2>æ­¥éª¤1ï¼šæµ‹è¯•è¡¨å•</h2>
                <form id="testForm">
                    <div class="form-group">
                        <label for="theme">é€‰æ‹©ä¸»é¢˜:</label>
                        <select id="theme" name="theme" required>
                            <option value="">è¯·é€‰æ‹©ä¸»é¢˜...</option>
                            <option value="å…¬äº¤ç«™">å…¬äº¤ç«™</option>
                            <option value="åšç‰©é¦†">åšç‰©é¦†</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="title">æ ‡é¢˜:</label>
                        <input type="text" id="title" name="title" required>
                    </div>

                    <button type="submit" class="btn btn-primary">æäº¤å¹¶è·³è½¬</button>
                    <button type="button" class="btn btn-secondary" onclick="testManualJump()">æ‰‹åŠ¨æµ‹è¯•è·³è½¬</button>
                </form>
            </div>

            <!-- æ­¥éª¤2 -->
            <div id="step2" class="step-content">
                <h2>æ­¥éª¤2ï¼šç»“æœé¡µé¢</h2>
                <div id="resultContainer">
                    <p>å¦‚æœçœ‹åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¯´æ˜è·³è½¬æˆåŠŸï¼</p>
                </div>
                <button class="btn btn-secondary" onclick="testGoBack()">è¿”å›æ­¥éª¤1</button>
            </div>
        </main>

        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div style="margin-top: 30px; padding: 20px; background: #f0f0f0; border-radius: 8px;">
            <h3>ğŸ› è°ƒè¯•ä¿¡æ¯</h3>
            <div id="debugInfo">ç­‰å¾…è°ƒè¯•...</div>
        </div>
    </div>

    <script src="vocabulary.js"></script>
    <script>
        let debugLog = [];

        function addDebugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            updateDebugDisplay();
            console.log(message);
        }

        function updateDebugDisplay() {
            const container = document.getElementById('debugInfo');
            if (container) {
                container.innerHTML = debugLog.map(log => `<div>${log}</div>`).join('');
            }
        }

        // å¢å¼ºç‰ˆçš„ goToStep å‡½æ•°ï¼ŒåŒ…å«è¯¦ç»†è°ƒè¯•
        function goToStep(step) {
            addDebugLog(`=== å¼€å§‹è·³è½¬åˆ°æ­¥éª¤ ${step} ===`);

            // æ£€æŸ¥å½“å‰æ‰€æœ‰æ­¥éª¤çš„çŠ¶æ€
            document.querySelectorAll('.step-content').forEach((el, index) => {
                const stepNum = index + 1;
                const isActive = el.classList.contains('active');
                addDebugLog(`æ­¥éª¤${stepNum} (${el.id}): active=${isActive}, display=${window.getComputedStyle(el).display}`);
            });

            // éšè—æ‰€æœ‰æ­¥éª¤
            addDebugLog('å¼€å§‹éšè—æ‰€æœ‰æ­¥éª¤...');
            document.querySelectorAll('.step-content').forEach(el => {
                el.classList.remove('active');
                addDebugLog(`ç§»é™¤ ${el.id} çš„ active ç±»`);
            });

            // æ˜¾ç¤ºç›®æ ‡æ­¥éª¤
            addDebugLog(`å‡†å¤‡æ˜¾ç¤ºæ­¥éª¤ ${step}`);
            const targetElement = document.getElementById(`step${step}`);
            if (targetElement) {
                targetElement.classList.add('active');
                addDebugLog(`å·²ç»™ ${targetElement.id} æ·»åŠ  active ç±»`);

                // å¼ºåˆ¶æ£€æŸ¥æ ·å¼
                setTimeout(() => {
                    const computedStyle = window.getComputedStyle(targetElement);
                    addDebugLog(`æ­¥éª¤${step} æœ€ç»ˆçŠ¶æ€: display=${computedStyle.display}, visibility=${computedStyle.visibility}`);

                    // æ£€æŸ¥å…ƒç´ æ˜¯å¦çœŸçš„å¯è§
                    const rect = targetElement.getBoundingClientRect();
                    addDebugLog(`æ­¥éª¤${step} ä½ç½®ä¿¡æ¯: top=${rect.top}, height=${rect.height}, visible=${rect.height > 0}`);
                }, 100);

            } else {
                addDebugLog(`âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ°æ­¥éª¤${step}å…ƒç´ `);
            }

            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
            addDebugLog('æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨...');
            document.querySelectorAll('.step').forEach(el => {
                el.classList.remove('active', 'completed');
            });

            for (let i = 1; i <= step; i++) {
                const indicator = document.querySelector(`.step[data-step="${i}"]`);
                if (indicator) {
                    if (i < step) {
                        indicator.classList.add('completed');
                    } else if (i === step) {
                        indicator.classList.add('active');
                    }
                }
            }

            addDebugLog(`=== æ­¥éª¤${step}è·³è½¬å®Œæˆ ===`);
        }

        // æ‰‹åŠ¨æµ‹è¯•è·³è½¬
        function testManualJump() {
            addDebugLog('ç”¨æˆ·ç‚¹å‡»æ‰‹åŠ¨æµ‹è¯•è·³è½¬æŒ‰é’®');
            goToStep(2);
        }

        // æµ‹è¯•è¿”å›
        function testGoBack() {
            addDebugLog('ç”¨æˆ·ç‚¹å‡»è¿”å›æŒ‰é’®');
            goToStep(1);
        }

        // è¡¨å•æäº¤å¤„ç†
        document.addEventListener('DOMContentLoaded', function() {
            addDebugLog('DOMåŠ è½½å®Œæˆ');

            const form = document.getElementById('testForm');
            if (form) {
                addDebugLog('æ‰¾åˆ°è¡¨å•ï¼Œç»‘å®šæäº¤äº‹ä»¶');
                form.addEventListener('submit', function(e) {
                    addDebugLog('è¡¨å•æäº¤äº‹ä»¶è§¦å‘');
                    e.preventDefault();

                    // éªŒè¯è¡¨å•
                    const formData = new FormData(e.target);
                    const theme = formData.get('theme');
                    const title = formData.get('title');

                    if (!theme || !title) {
                        alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                        return;
                    }

                    addDebugLog(`è¡¨å•éªŒè¯é€šè¿‡: theme=${theme}, title=${title}`);

                    // æ¨¡æ‹Ÿå¤„ç†
                    setTimeout(() => {
                        addDebugLog('å¼€å§‹è·³è½¬åˆ°æ­¥éª¤2');
                        goToStep(2);

                        // æ›´æ–°ç»“æœå†…å®¹
                        const resultContainer = document.getElementById('resultContainer');
                        if (resultContainer) {
                            resultContainer.innerHTML = `
                                <div class="result-section">
                                    <h3>âœ… è·³è½¬æˆåŠŸï¼</h3>
                                    <p><strong>ä¸»é¢˜:</strong> ${theme}</p>
                                    <p><strong>æ ‡é¢˜:</strong> ${title}</p>
                                    <p><strong>è·³è½¬æ—¶é—´:</strong> ${new Date().toLocaleString()}</p>
                                </div>
                            `;
                        }
                    }, 500);
                });
            } else {
                addDebugLog('âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ°è¡¨å•å…ƒç´ ');
            }

            addDebugLog('åˆå§‹åŒ–å®Œæˆ');
        });

        // å®šæœŸæ£€æŸ¥æ­¥éª¤çŠ¶æ€
        setInterval(() => {
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');

            if (step1 && step2) {
                const step1Active = step1.classList.contains('active');
                const step2Active = step2.classList.contains('active');

                if (!debugLog.includes('æ­¥éª¤çŠ¶æ€æ£€æŸ¥')) {
                    addDebugLog(`å½“å‰çŠ¶æ€: æ­¥éª¤1=${step1Active}, æ­¥éª¤2=${step2Active}`);
                }
            }
        }, 2000);
    </script>
</body>
</html>